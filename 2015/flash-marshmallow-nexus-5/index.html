<!DOCTYPE html><html><head><title>给Nexus 5吃棉花糖 | Carlog</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><link rel="alternate" href="atom.xml" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/main.css" type="text/css"></head><body><header><div class="wrapper"><a href="/" class="site-title"><code>Carlog</code></a><div class="menu"><span class="hamburger"><span></span></span></div><nav role="navigation" class="nav"><a href="/">Home</a><a href="/archives">Archives</a><a href="/atom.xml">RSS</a></nav></div></header><section class="main post"><div class="wrapper clearfix"><div class="post-header"><h2 class="post-title"><a href="/2015/flash-marshmallow-nexus-5/">给Nexus 5吃棉花糖</a></h2><time datetime="2015-10-06T13:51:54.000Z">October 6, 2015</time></div><div class="post-content"><p>昨天晚上刷了一下Nexus factory image的页面，还没有Marshmallow的下载地址。于是我<a href="http://weibo.com/1351146375/CDPSxui4x?from=page_1005051351146375_profile&amp;wvr=6&amp;mod=weibotime&amp;type=comment#_rnd1444136437374" target="_blank" rel="external">刷了个Flyme</a>玩了一下。睡觉前刷推，看到Marshmallow下载地址放出了。于是今天就刷了Marshmallow(其实，flyme还挺不错)，下面是一点记录。</p>
<a id="more"></a>
<h3 id="下载factory-image"><a href="#下载factory-image" class="headerlink" title="下载factory image"></a>下载factory image</h3><p>先从<a href="https://developers.google.com/android/nexus/images" target="_blank" rel="external">Factory Images for Nexus Devices</a>下载image。要记住下载完之后，一定要验证好md5sum和(或)sha1sum，尤其当你是从别的地方下载时。</p>
<h3 id="How-to-flash-a-system-image"><a href="#How-to-flash-a-system-image" class="headerlink" title="How to flash a system image"></a>How to flash a system image</h3><p>方法在前面提到官方的image下载页面就有详细的说明。</p>
<p>直接在Windows上刷的话可能会有USB driver上的问题。反正我是通过VirtualBox中的Ubuntu来刷机的，ubuntu中安装adb/fastboot tool也非常方便。如果是像我这样通过虚拟机刷机，不要忘记手机插上Host的USB后要把设备分配给Guest虚拟机。</p>
<p>我在刷的过程中，每次刷好bootloader和radio后，都会遇到下面的问题，试了几次都一样。</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><div class="line">archive does <span class="keyword">not</span> contain <span class="string">'boot.sig'</span></div><div class="line">archive does <span class="keyword">not</span> contain <span class="string">'recovery.sig'</span></div><div class="line">failed <span class="built_in">to</span> allocate <span class="number">1043723460</span> <span class="keyword">bytes</span></div><div class="line">error: update package missing <span class="keyword">system</span>.img</div></pre></td></tr></table></figure>
<p>解决方法就是把<code>image-hammerhead-mra58k.zip</code>解包后分开刷。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><div class="line">root<span class="variable">@ubuvm:</span>~/hammerhead-mra58k# unzip image-hammerhead-mra58k.zip </div><div class="line"><span class="attribute">Archive</span>:  image-hammerhead-mra58k.zip</div><div class="line">  <span class="attribute">inflating</span>: android-info.txt        </div><div class="line">  <span class="attribute">inflating</span>: cache.img               </div><div class="line">  <span class="attribute">inflating</span>: boot.img                </div><div class="line">  <span class="attribute">inflating</span>: recovery.img            </div><div class="line">  <span class="attribute">inflating</span>: userdata.img            </div><div class="line">  <span class="attribute">inflating</span>: system.img</div></pre></td></tr></table></figure>
<p>其中刷<code>system.img</code>的过程时间会比较长点，要耐心一点。</p>
<figure class="highlight less"><table><tr><td class="code"><pre><div class="line">root<span class="variable">@ubuvm:</span>~/hammerhead-mra58k# fastboot flash boot boot.img </div><div class="line">target reported max download size of <span class="number">1073741824</span> bytes</div><div class="line">sending <span class="string">'boot'</span> (<span class="number">9156</span> KB)...</div><div class="line">OKAY [  <span class="number">2.108s</span>]</div><div class="line">writing <span class="string">'boot'</span>...</div><div class="line">OKAY [  <span class="number">0.794s</span>]</div><div class="line">finished. total <span class="attribute">time</span>: <span class="number">2.902s</span></div><div class="line">root<span class="variable">@ubuvm</span>:~/hammerhead-mra58k# fastboot flash recovery recovery.img </div><div class="line">target reported max download size of <span class="number">1073741824</span> bytes</div><div class="line">sending <span class="string">'recovery'</span> (<span class="number">10016</span> KB)...</div><div class="line">OKAY [  <span class="number">2.083s</span>]</div><div class="line">writing <span class="string">'recovery'</span>...</div><div class="line">OKAY [  <span class="number">0.851s</span>]</div><div class="line">finished. total <span class="attribute">time</span>: <span class="number">2.935s</span></div><div class="line">root<span class="variable">@ubuvm</span>:~/hammerhead-mra58k# fastboot flash system system.img </div><div class="line">target reported max download size of <span class="number">1073741824</span> bytes</div><div class="line">erasing <span class="string">'system'</span>...</div><div class="line">OKAY [  <span class="number">1.338s</span>]</div><div class="line">sending <span class="string">'system'</span> (<span class="number">1019261</span> KB)...</div><div class="line">OKAY [<span class="number">215.548s</span>]</div><div class="line">writing <span class="string">'system'</span>...</div><div class="line">OKAY [ <span class="number">70.168s</span>]</div><div class="line">finished. total <span class="attribute">time</span>: <span class="number">287.059s</span></div><div class="line">root<span class="variable">@ubuvm</span>:~/hammerhead-mra58k# fastboot flash cache cache.img </div><div class="line">target reported max download size of <span class="number">1073741824</span> bytes</div><div class="line">erasing <span class="string">'cache'</span>...</div><div class="line">OKAY [  <span class="number">0.511s</span>]</div><div class="line">sending <span class="string">'cache'</span> (<span class="number">13348</span> KB)...</div><div class="line">OKAY [  <span class="number">2.990s</span>]</div><div class="line">writing <span class="string">'cache'</span>...</div><div class="line">OKAY [  <span class="number">1.495s</span>]</div><div class="line">finished. total <span class="attribute">time</span>: <span class="number">4.996s</span></div><div class="line">root<span class="variable">@ubuvm</span>:~/hammerhead-mra58k# fastboot flash userdata userdata.img </div><div class="line">target reported max download size of <span class="number">1073741824</span> bytes</div><div class="line">erasing <span class="string">'userdata'</span>...</div><div class="line">OKAY [ <span class="number">12.978s</span>]</div><div class="line">sending <span class="string">'userdata'</span> (<span class="number">137318</span> KB)...</div><div class="line">OKAY [ <span class="number">29.485s</span>]</div><div class="line">writing <span class="string">'userdata'</span>...</div><div class="line">OKAY [  <span class="number">9.136s</span>]</div><div class="line">finished. total <span class="attribute">time</span>: <span class="number">51.599s</span></div></pre></td></tr></table></figure>
<p>最后一步falsh userdata，会抹除手机上的用户数据/应用等。上面的步骤完成后，重启手机。第一次启动的时间会比较长。</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="attribute">fastboot</span> reboot</div></pre></td></tr></table></figure>
<p>初始化设置的时候，会提示连接到WIFI，连接之后就会出现“正在检查网络连接…此过程最多可能需要2分钟”，不要信它，我等了十几分钟也没好，所以可以跳过，先不要连WIFI。</p>
<h3 id="root"><a href="#root" class="headerlink" title="root"></a>root</h3><p>参考xda上这个<a href="http://forum.xda-developers.com/showpost.php?p=63147932&amp;postcount=81" target="_blank" rel="external">回复</a>。</p>
<p>目前Nexsus marshmallow要root的话，需要替换kernel。下载地址<a href="http://www.mediafire.com/download/b69gq3wnanmmd4g/StephanMc_Kernel-hammerhead-20150904.zip" target="_blank" rel="external">在这</a>，这个kernel相对原厂kernel的区别就是可root，没做其他优化和更改。</p>
<p>下载解压后，会有个boot.img，然后flash：</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><div class="line">fastboot flash <span class="keyword">boot</span> <span class="keyword">boot</span>.img</div></pre></td></tr></table></figure>
<p>再刷入第三方的recovery，目前最有名的就是TWRP的recovery了。Nexus 5的TWRP recovery<a href="https://dl.twrp.me/hammerhead/" target="_blank" rel="external">在这</a>。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><div class="line"><span class="selector-tag">fastboot</span> <span class="selector-tag">flash</span> <span class="selector-tag">recovery</span> <span class="selector-tag">twrp-2</span><span class="selector-class">.8</span><span class="selector-class">.7</span><span class="selector-class">.1-hammerhead</span><span class="selector-class">.img</span></div></pre></td></tr></table></figure>
<p>重启手机，进入recovery。然后卡刷Beta版的Supersu。下载地址<a href="https://download.chainfire.eu/740/SuperSU/BETA-SuperSU-v2.49.zip" target="_blank" rel="external">在这</a>。到此就root完成了。</p>
<h3 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h3><p>在5.0时，状态栏WIFI标志上会有感叹号，在6.0上问题还是一样。这也会导致系统更耗电。出现这个问题的原因，以及解决的方法，看这篇<a href="http://www.noisyfox.cn/45.html" target="_blank" rel="external">文章</a>。</p>
</div><div class="post-footer">Updated on 16/07/10</div></div><div class="post-nav"><div style="height: 0; width: 0; position: absolute; visibility: hidden">
  <!-- inject:svg --><svg xmlns="http://www.w3.org/2000/svg"><symbol id="ic_chevron_left_white_24px" viewBox="0 0 24 24">
    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</symbol><symbol id="ic_chevron_right_white_24px" viewBox="0 0 24 24">
    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</symbol></svg><!-- endinjected -->
</div><a href="/2015/vagrant-is-pretty-good/" class="nav prev"><svg class="icon left"><use xlink:href="#ic_chevron_left_white_24px"></use></svg>PREVIOUS</a><a href="/2015/build-and-install-from-source-with-out-root/" class="nav next">NEXT<svg class="icon right"><use xlink:href="#ic_chevron_right_white_24px"></use></svg></a></div></section><footer><h3>Carlog</h3><div class="additional"><span>&copy;</span> 2016 <a href="http://hanhaishan.com">Haishan</a><br> Powered by <a href="https://hexo.io">Hexo</a>, theme using <a href="https://github.com/haishanh/hexo-theme-zxcvb">zxcvb</a>, hosted by <a href="https://github.com/haishanh/blog/tree/gh-pages">Github Pages</a></div></footer><script src="/js/script.js"></script></body></html>